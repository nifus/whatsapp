<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">{{env.id==undefined ? "Добавить компанию" : "Изменить компанию"}}</h3>

    </div>
    <div class="panel-body">
        <form name="companyProfileForm">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group"
                         ng-class="{ 'has-error': companyProfileForm.companyProfileName.$invalid }">
                        <label for="input1">Наименование:</label>
                        <input type="text" class="form-control" id="input1" ng-model="env.model.name"
                               name="companyProfileName" required="required">
                    </div>
                    <div class="form-group"
                         ng-class="{ 'has-error': companyProfileForm.companyProfilePhone.$invalid }">
                        <label for="input2">Телефон:</label>
                        <input type="text" class="form-control" id="input2" ng-model="env.model.phone"
                               name="companyProfilePhone" required="required">
                    </div>

                    <div class="form-group"
                         ng-class="{ 'has-error': companyProfileForm.repeatSelect.$invalid }">
                        <label>Выберите контрагента:</label>
                        <select name="repeatSelect" required
                                class="form-control"
                                ng-options="option.id as option.name for option in env.agents"
                                ng-model="env.model.agent_id">
                            <option value="">Выберите контрагента</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="input3">Email:</label>
                        <input type="text" class="form-control" id="input3" ng-model="env.model.email">
                    </div>
                    <div class="form-group">
                        <label for="input4">Юридический Адрес:</label>
                        <input type="text" class="form-control" id="input4" ng-model="env.model.ur_address">
                    </div>
                    <div class="form-group">
                        <label for="input5">Фактический Адрес:</label>
                        <input type="text" class="form-control" id="input5" ng-model="env.model.fact_address">
                    </div>
                    <div class="form-group">
                        <label for="input6">ОГРН:</label>
                        <input type="text" class="form-control" id="input6" ng-model="env.model.ogrn">
                    </div>
                    <div class="form-group">
                        <label for="input7">ИНН:</label>
                        <input type="text" class="form-control" id="input7" ng-model="env.model.inn">
                    </div>
                    <div class="form-group">
                        <label for="input8">КПП:</label>
                        <input type="text" class="form-control" id="input8" ng-model="env.model.kpp">
                    </div>
                    <div class="form-group">
                        <label for="input9">ОКВЭД:</label>
                        <input type="text" class="form-control" id="input9" ng-model="env.model.okvd">
                    </div>
                    <div class="form-group">
                        <label for="input10">ОКАТО:</label>
                        <input type="text" class="form-control" id="input10" ng-model="env.model.okato">
                    </div>
                    <div class="form-group">
                        <label for="input11">ОКПО:</label>
                        <input type="text" class="form-control" id="input11" ng-model="env.model.okpo">
                    </div>
                    <div class="form-group">
                        <label for="input12">Генеральный директор:</label>
                        <input type="text" class="form-control" id="input12" ng-model="env.model.ceo">
                    </div>
                    <div class="form-group">
                        <label for="input13">Главный бухгалтер:</label>
                        <input type="text" class="form-control" id="input13"
                               ng-model="env.model.chief_accountant">
                    </div>

                    <div class="form-group">
                        <label>Комментарий:</label>
                        <textarea class="form-control" rows="5" ng-model="env.model.comment"></textarea>
                    </div>


                </div>

                <div class="col-md-6">
                    <h4>Список счетов</h4>

                    <div ng-repeat="account in env.model.company_accounts" style="padding-bottom:20px">
                        <h3>Банковский счет: #{{$index + 1}}:
                            <button class="btn btn-danger pull-right" type="button"
                                    ng-click="removeCompanyAcc(account, $index)">удалить
                            </button>
                        </h3>
                        <div class="form-group"
                             ng-class="{ 'has-error': companyProfileForm['companyAccBank{{$index}}'].$invalid }">
                            <label>Наименование банка:</label>
                            <input type="text" class="form-control" ng-model="account.bank"
                                   name="companyAccBank{{$index}}" required="required">
                        </div>
                        <div class="form-group"
                             ng-class="{ 'has-error': companyProfileForm['companyAccBik{{$index}}'].$invalid }">
                            <label>БИК:</label>
                            <input type="text" class="form-control" ng-model="account.bik"
                                   name="companyAccBik{{$index}}" required="required">
                        </div>
                        <div class="form-group">
                            <label for="input16">ИНН БАНКА:</label>
                            <input type="text" class="form-control" id="input16" ng-model="account.inn">
                        </div>
                        <div class="form-group">
                            <label for="input17">ОГРН БАНКА:</label>
                            <input type="text" class="form-control" id="input17" ng-model="account.ogrn">
                        </div>
                        <div class="form-group">
                            <label>КОР. СЧЁТ:</label>
                            <input type="text" class="form-control"
                                   ng-model="account.correspondent_account">
                        </div>
                        <div class="form-group"
                             ng-class="{ 'has-error': companyProfileForm['companyAccCheckAcc{{$index}}'].$invalid }">
                            <label>РАСЧЁТНЫЙ СЧЁТ:</label>
                            <input type="text" class="form-control"
                                   ng-model="account.checking_account"
                                   name="companyAccCheckAcc{{$index}}" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-primary" type="button" ng-click="addNewCompanyAcc()"><span
                                class="glyphicon glyphicon-plus"></span> добавить новый счёт
                        </button>
                    </div>


                </div>
            </div>
            <div class="row">
                <div class="col-md-12 text-left">

                    <button type="button" class="btn btn-success"
                            ng-disabled="companyProfileForm.$invalid || env.company.waiting==true"
                            ng-click="save(env.model)">Сохранить
                    </button>


                </div>
            </div>
        </form>
    </div>
</div>


<div class="panel panel-default" ng-show="env.model.id">
    <div class="panel-heading">
        <h3 class="panel-title">Технические файлы по компании</h3>
    </div>
    <div class="panel-body">
        <div class="col-md-6">

            <div class="row" style="margin-top: 20px;margin-bottom: 50px">
                <input type="file" ng-model="env.uploadEnv.model" base-sixty-four-input multiple
                       onloadend="upl">
            </div>
            <div class="progress" ng-show="env.uploadEnv.loading==true">
                <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100"
                     aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                </div>
            </div>
            <div class="row" ng-repeat="file in env.model.files" style="margin:10px">
                <div class="col-md-1">
                    <button type="button" class="btn btn-danger btn-xs" ng-click="removeFile(file,$index)">
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    </button>
                </div>
                <div class="col-md-6">
                    <a target="_blank" ng-href="{{file.serverpath}}">{{file.filename}}</a>
                </div>

            </div>

        </div>
    </div>
</div>


<div class="row" ng-show="env.model.id">
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Финансовая сводка по компании:</h3>
            </div>
            <div class="panel-body">

                <table class="table table-striped table-hover" ng-show="env.model.debt">
                    <thead>
                    <tr>
                        <th>Долг компании перед оператором</th>
                        <th>Долг оператора перед компанией</th>
                        <th>Валюта</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="(cur, debt) in env.model.debt">
                        <td>{{debt.operator|currency:cur}}</td>
                        <td>{{debt.agent|currency:cur}}</td>
                        <td>{{cur}}</td>
                    </tr>

                    </tbody>
                </table>
                <div ng-show="!env.model.debt">
                    <p>Нет фин. сводки</p>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">

        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Связь с контрагентом</h3>
            </div>
            <div class="panel-body">

                <h3><a ui-sref="agent-profile({id: env.company.agent.id})"
                       >{{env.company.agent.name}}</a>
                </h3>

            </div>
        </div>
    </div>
</div>

<div ng-show="env.id">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">Связанные с компанией проводки:</h3>
        </div>
        <div class="panel-body">
            <payment-table company="{{env.id}}"></payment-table>
        </div>
    </div>

</div>
