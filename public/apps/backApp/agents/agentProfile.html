<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">{{env.id==undefined ? "Добавить контрагента" : "Изменить контрагента"}}</h3>
    </div>
    <div class="panel-body">
        <form name="agentForm">

            <div class="row">
                <div class="col-md-4">
                    <div class="form-group" ng-class="{ 'has-error': agentForm.name.$invalid }">
                        <label>Контрагент:</label>
                        <input type="text" name="name" class="form-control" ng-model="env.model.name" required>
                    </div>

                    <div class="form-group">
                        <label>Телефон:</label>
                        <input type="text" class="form-control" ng-model="env.model.phone">
                    </div>


                    <div class="form-group">
                        <label>Комментарий:</label>
                            <textarea class="form-control" rows="5"
                                      ng-model="env.model.comment"></textarea>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="form-group" ng-class="{ 'has-error': agentForm.email.$invalid }">
                        <label>Email:</label>
                        <input type="email" name="email" class="form-control" ng-model="env.model.email"
                               required>
                    </div>
                    <div class="form-group">
                        <label>Когда отправлять:</label>

                        <div class="checkbox">
                            <label style="margin-right: 15px;"><input type="checkbox"
                                                                      ng-model="env.model.day_delivery['пн.']"/>
                                пн.</label>

                            <label style="margin-right: 15px;"><input type="checkbox"
                                                                      ng-model="env.model.day_delivery['вт.']"/>вт.</label>
                            <label style="margin-right: 15px;"><input type="checkbox"
                                                                      ng-model="env.model.day_delivery['ср.']"/>ср.</label>
                            <label style="margin-right: 15px;"><input type="checkbox"
                                                                      ng-model="env.model.day_delivery['чт.']"/>чт.</label>
                            <label style="margin-right: 15px;"><input type="checkbox"
                                                                      ng-model="env.model.day_delivery['пт.']"/>пт.</label>
                            <label style="margin-right: 15px;"><input type="checkbox"
                                                                      ng-model="env.model.day_delivery['сб.']"/>сб.</label>
                            <label style="margin-right: 15px;"><input type="checkbox"
                                                                      ng-model="env.model.day_delivery['вс.']"/>вс.</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Рассылка отчётов:</label>
                        <select class="form-control" ng-model="env.model.report_delivery">
                            <option value="7">7 дней</option>
                            <option value="14">14 дней</option>
                            <option value="30">30 дней</option>
                            <option value="90">90 дней</option>
                            <option value="180">180 дней</option>
                            <option value="360">360 дней</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Легенда:</label>

                        <div class="checkbox">
                            <div class="row">
                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['pik']"/>ПИК
                                        —
                                        Поставщик
                                        Имя Компания
                                    </label>
                                </div>
                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['pc']"/>ПС
                                        — Поставщик
                                        сумма
                                    </label>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['pndpp']"/>ПНДПП
                                        —
                                        Поставщик номер и дата П/П
                                    </label>

                                </div>
                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['pks']"/>ПКС
                                        —
                                        Поставщик
                                        комиссия сумма
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6"><label>
                                    <input type="checkbox" ng-model="env.model.info_delivery['pkp']"/>ПКП —
                                    Поставщик
                                    процент комиссия
                                </label></div>

                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['pki']"/>ПКИ
                                        —
                                        Поставщик
                                        комиссия итог
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['ai']"/>АИ
                                        — Агент имя
                                    </label>
                                </div>

                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['aic']"/>АКС
                                        — Агент
                                        комиссия сумма
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['akp']"/>АКП
                                        — Агент
                                        комиссия процент
                                    </label>
                                </div>

                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['aku']"/>АКИ
                                        — Агент
                                        комиссия итог
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['zik']"/>ЗИК
                                        — Заказчик
                                        Имя
                                        Компания
                                    </label>
                                </div>

                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['zsi']"/>ЗС
                                        — Заказчик
                                        сумма
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['znlpp']"/>ЗНДПП
                                        —
                                        Заказчик
                                        номер и дата П/П
                                    </label>
                                </div>

                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['zks']"/>ЗКС
                                        — Заказчик
                                        комиссия сумма
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['zkp']"/>ЗКП
                                        — Заказчик
                                        комиссия процент
                                    </label>
                                </div>

                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['zki']"/>ЗКИ
                                        — Заказчик
                                        комиссия итог
                                    </label>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['okp']"/>ОКП
                                        — Оператор комиссия процент

                                    </label>
                                </div>

                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['oks']"/>ОКС
                                        — Оператор комиссия сумма

                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>
                                        <input type="checkbox" ng-model="env.model.info_delivery['oki']"/>ОКИ
                                        — Оператор комиссия итог


                                    </label>
                                </div>


                            </div>
                        </div>
                    </div>
                </div>

            </div>


            <div class="row">
                <div class="col-md-12 text-left">
                    <button type="button" class="btn btn-success"
                            ng-disabled="agentForm.$invalid || env.agent.waiting==true"
                            ng-click="save(env.model)">Сохранить
                    </button>
                </div>
            </div>
            <br/>
        </form>
    </div>
</div>

<div class="panel panel-default" ng-show="env.model.id">
    <div class="panel-heading">
        <h3 class="panel-title">Технические файлы по контрагенту</h3>
    </div>
    <div class="panel-body">
        <div class="col-md-6">
            <div class="row" style="margin-top: 20px;margin-bottom: 50px">
                <input type="file" ng-model="env.uploadEnv.model" base-sixty-four-input multiple
                       onloadend="upl">
            </div>
            <div class="progress" ng-show="env.uploadEnv.loading==true">
                <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100"
                     aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                </div>
            </div>
            <div class="row" ng-repeat="file in env.model.files" style="margin:10px">
                <div class="col-md-1">
                    <button type="button" class="btn btn-danger btn-xs" ng-click="removeFile(file,$index)">
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    </button>
                </div>
                <div class="col-md-6">
                    <a target="_blank" ng-href="{{file.serverpath}}">{{file.filename}}</a>
                </div>

            </div>

        </div>
    </div>
</div>


<div class="row" ng-show="env.model.id">
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Финансовая сводка по контрагенту:</h3>
            </div>
            <div class="panel-body">
                <table class="table table-striped table-hover" ng-show=" env.model.debt">
                    <thead>
                    <tr>
                        <th>Долг контрагента перед оператором</th>
                        <th>Долг оператора перед контрагентом</th>
                        <th>Валюта</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="(cur, debt) in env.model.debt">
                        <td>{{debt.operator|currency:cur}}</td>
                        <td>{{debt.agent|currency:cur}}</td>
                        <td>{{cur}}</td>
                    </tr>

                    </tbody>
                </table>
                <div ng-show="!env.model.debt">
                    <p>Нет фин. сводки</p>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">

        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Связанные с контрагентом компании</h3>
            </div>
            <div class="panel-body">
                <table class="table table-striped table-hover" ng-show="env.agent.companies.length>0">
                    <thead>
                    <tr>
                        <th>Наименование компании</th>
                        <th>Кол-во проводок</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="item in env.agent.companies" ng-click="openCompany(item.id)"
                        style="cursor: pointer">
                        <td>{{item.name}}</td>
                        <td>{{item.number_of_payments}}</td>
                    </tr>
                    </tbody>
                </table>
                <div ng-show="env.agent.companies.length==0">
                    <p>Нет компаний</p>
                </div>
                <button class="btn btn-default" ui-sref="company-create({agent_id:env.agent.id})" type="button">
                    Добавить
                </button>

            </div>
        </div>
    </div>
</div>


<div class="panel panel-default" ng-show="env.model.id">
    <div class="panel-heading">
        <h3 class="panel-title">Связанные проводки с контрагентом</h3>
    </div>
    <div class="panel-body">
        <payment-table agent="{{env.id}}" ng-show="env.model.id"></payment-table>

    </div>
</div>
